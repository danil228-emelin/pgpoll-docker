# PostgreSQL Replication with PgPool-II

Этот проект демонстрирует настройку репликации PostgreSQL с использованием PgPool-II для балансировки нагрузки и высокой доступности. Проект реализован с использованием Docker и Docker Compose.

## Архитектура проекта

Проект состоит из следующих компонентов:

- **node_a** (Primary): Основной узел PostgreSQL (порт 5432)
- **node_b** (Replica): Реплика PostgreSQL (порт 5435)
- **node_c** (Replica): Реплика PostgreSQL (порт 5436)
- **pgpool**: Сервис балансировки нагрузки и высокой доступности (порт 9999)
- **pgclient**: Клиентский контейнер для тестирования

Все сервисы находятся в одной сети `pg_net` с фиксированными IP-адресами для стабильной работы репликации.

## Требования

- Docker
- Docker Compose
- Bash (для запуска скриптов проверки)

## Структура проекта

```
.
├── docker-compose.yml      # Конфигурация Docker Compose
├── check_replication.sh    # Скрипт проверки репликации
├── node_a/                 # Конфигурация основного узла
├── node_b/                 # Конфигурация реплики B
├── node_c/                 # Конфигурация реплики C
└── pgpool/                # Конфигурация PgPool-II
```

## Запуск проекта

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd pgpoll-docker
   ```

2. Запустите все сервисы:
   ```bash
   docker-compose up -d
   ```

3. Дождитесь инициализации всех сервисов (это может занять несколько минут)

## Проверка работоспособности

1. Проверка статуса репликации:
   ```bash
   ./check_replication.sh
   ```

2. Подключение к базе данных через PgPool-II:
   ```bash
   docker exec -it pgclient psql -h pgpool -U postgres
   ```

## Порты и доступ

- **node_a**: localhost:5432
- **node_b**: localhost:5435
- **node_c**: localhost:5436
- **pgpool**: localhost:9999 (основной порт), localhost:9898 (административный интерфейс)

## Учетные данные

- **PostgreSQL**:
  - Пользователь: postgres
  - Пароль: postgres

- **PgPool-II Admin**:
  - Пользователь: admin
  - Пароль: admin_pass

## Мониторинг и управление

- Статус репликации можно проверить через скрипт `check_replication.sh`
- Административный интерфейс PgPool-II доступен на порту 9898
- Для проверки статуса контейнеров используйте:
  ```bash
  docker-compose ps
  ```

## Остановка проекта

Для остановки всех сервисов выполните:
```bash
docker-compose down
```

Для полного удаления всех данных (включая тома):
```bash
docker-compose down -v
```

## Примечания

- Все сервисы настроены с проверкой здоровья (healthcheck)
- Репликация настроена в каскадном режиме (node_a -> node_b -> node_c)
- PgPool-II автоматически определяет основной узел и реплики
- Все контейнеры используют фиксированные IP-адреса в сети для стабильной работы репликации 
